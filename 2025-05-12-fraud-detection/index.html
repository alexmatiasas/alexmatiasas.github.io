<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.26.2 by Michael Rose
  Copyright 2013-2024 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en-US" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>
  
    Manuel Alejandro Mat√≠as Astorga | Data Science Portfolio ‚Äì Machine Learning & AI Projects
  
</title>
<meta name="description" content="A showcase of my Data Science and Machine Learning projects.">


  <meta name="author" content="Manuel Alejandro Mat√≠as Astorga">
  
  <meta property="article:author" content="Manuel Alejandro Mat√≠as Astorga">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Manuel Alejandro Mat√≠as Astorga | Data Science Portfolio ‚Äì Machine Learning & AI Projects">
<meta property="og:title" content="Manuel Alejandro Mat√≠as Astorga | Data Science Portfolio ‚Äì Machine Learning &amp; AI Projects">
<meta property="og:url" content="https://alexmatiasas.github.io/2025-05-12-fraud-detection/">


  <meta property="og:description" content="A showcase of my Data Science and Machine Learning projects.">



  <meta property="og:image" content="https://alexmatiasas.github.io/assets/images/teaser.jpg">



  <meta name="twitter:site" content="@alexmatiasas">
  <meta name="twitter:title" content="Manuel Alejandro Mat√≠as Astorga | Data Science Portfolio ‚Äì Machine Learning &amp; AI Projects">
  <meta name="twitter:description" content="A showcase of my Data Science and Machine Learning projects.">
  <meta name="twitter:url" content="https://alexmatiasas.github.io/2025-05-12-fraud-detection/">

  
    <meta name="twitter:card" content="summary">
    
      <meta name="twitter:image" content="https://alexmatiasas.github.io/assets/images/teaser.jpg">
    
  

  



  <meta property="article:published_time" content="2025-06-19T16:44:59-06:00">





  

  


<link rel="canonical" href="https://alexmatiasas.github.io/2025-05-12-fraud-detection/">












<!-- end _includes/seo.html -->


<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  window.enable_copy_code_button = true;
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single" dir="ltr">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/logo.svg" alt="Data Science Portfolio"></a>
        
        <a class="site-title" href="/">
          Data Science Portfolio
          <span class="site-subtitle">by Manuel Alejandro Mat√≠as Astorga</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/"
                 title="Home page"
                
              >Home</a>
            </li><li class="masthead__menu-item">
              <a
                href="/about"
                 title="About page"
                
              >About</a>
            </li><li class="masthead__menu-item">
              <a
                href="/projects/"
                 title="All projects"
                
              >Projects</a>
            </li><li class="masthead__menu-item">
              <a
                href="/blog/"
                 title="All blog posts"
                
              >Blog</a>
            </li><li class="masthead__menu-item">
              <a
                href="/tags/"
                 title="All tags"
                
              >Tags</a>
            </li><li class="masthead__menu-item">
              <a
                href="/categories/"
                 title="All categories"
                
              >Categories</a>
            </li><li class="masthead__menu-item">
              <a
                href="/contact"
                 title="Contact page"
                
              >Contact</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      




  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/" itemprop="item"><span itemprop="name">Home</span></a>

          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        <li class="current"></li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person" class="h-card">

  
    <div class="author__avatar">
      <a href="https://alexmatiasas.github.io/">
        <img src="/assets/images/profile_photo.jpg" alt="Manuel Alejandro Mat√≠as Astorga" itemprop="image" class="u-photo">
      </a>
    </div>
  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      <a class="u-url" rel="me" href="https://alexmatiasas.github.io/" itemprop="url">Manuel Alejandro Mat√≠as Astorga</a>
    </h3>
    
      <div class="author__bio p-note" itemprop="description">
        <p>Data Scientist and Machine Learning Engineer.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name" class="p-locality">Mexico City, Mexico</span>
        </li>
      

      
        
          
            <li><a href="mailto: alejandromatiasastorga@gmail.com" rel="nofollow noopener noreferrer me"><i class="fas fa-fw fa-envelope" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
          
            <li><a href="/" rel="nofollow noopener noreferrer me"><i class="fas fa-fw fa-globe" aria-hidden="true"></i><span class="label">Website</span></a></li>
          
        
          
        
          
            <li><a href="https://github.com/alexmatiasas" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/alexmatiasastorga/" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">Linkedin</span></a></li>
          
        
          
            <li><a href="https://www.kaggle.com/alejandromatias" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-kaggle" aria-hidden="true"></i><span class="label">Kaggle</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    
    <meta itemprop="description" content="">
    <meta itemprop="datePublished" content="2025-06-19T16:44:59-06:00">
    

    <div class="page__inner-wrap">
      
        <header>
          
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu"><li><a href="#-project-overview">üìå Project Overview</a></li><li><a href="#-exploratory-data-analysis">üîç Exploratory Data Analysis</a><ul><li><a href="#1-class-imbalance">1. Class Imbalance</a></li><li><a href="#2-missing-value-patterns">2. Missing-Value Patterns</a></li><li><a href="#3-categorical-fraud-rates">3. Categorical Fraud Rates</a></li><li><a href="#4-temporal-signal">4. Temporal Signal</a></li><li><a href="#key-takeaways">Key Takeaways</a></li></ul></li><li><a href="#-data-preprocessing-pipeline">üîß Data Preprocessing Pipeline</a></li><li><a href="#-baseline-models">üèÅ Baseline Models</a></li><li><a href="#Ô∏è-phase-2-advanced-models--ensembles">‚öôÔ∏è Phase 2: Advanced Models &amp; Ensembles</a><ul><li><a href="#1-xgboost">1 XGBoost</a></li><li><a href="#2-lightgbm">2 LightGBM</a></li><li><a href="#3-catboost">3 CatBoost</a></li></ul></li><li><a href="#Ô∏è-phase-3-hyperparameter-tuning">‚öôÔ∏è Phase 3: Hyperparameter Tuning</a><ul><li><a href="#-key-takeaways">üîç Key Takeaways</a></li></ul></li><li><a href="#-phase-4-ensemble-models">üîó Phase 4: Ensemble Models</a><ul><li><a href="#1-soft-voting-ensemble">1 Soft Voting Ensemble</a></li><li><a href="#2-stacking-ensemble">2 Stacking Ensemble</a></li></ul></li><li><a href="#-testing">üß™ Testing</a></li><li><a href="#Ô∏è-deployment">üñ•Ô∏è Deployment</a></li><li><a href="#-conclusion">üìå Conclusion</a></li><li><a href="#-links">üîó Links</a></li></ul>
            </nav>
          </aside>
        
        <h2 id="-project-overview">üìå Project Overview</h2>

<p>This project implements a complete machine learning pipeline to detect fraudulent transactions using the <a href="https://www.kaggle.com/c/ieee-fraud-detection">IEEE-CIS dataset</a>. It includes:</p>

<ul>
  <li>Deep EDA in <strong>R</strong> and <strong>Python</strong></li>
  <li>Robust preprocessing and feature engineering</li>
  <li>Ensemble modeling (XGBoost, LightGBM, CatBoost)</li>
  <li>A FastAPI deployment for real-time predictions</li>
  <li>Unit testing with <code class="language-plaintext highlighter-rouge">pytest</code> for pipeline robustness</li>
</ul>

<p>üöÄ Check the full repository: <a href="https://github.com/alexmatiasas/Fraud-Detection-with-ML">GitHub</a></p>

<hr />

<h2 id="-exploratory-data-analysis">üîç Exploratory Data Analysis</h2>

<p>Full notebook: <a href="https://rpubs.com/Alex_matias_as/fraud-detection-eda">RPubs EDA report</a></p>

<p>To lay the foundation for modeling, we explored class balance, missingness, temporal patterns and categorical signals‚Äîselecting only the most actionable insights below.</p>

<hr />

<h3 id="1-class-imbalance">1. Class Imbalance</h3>

<p><img src="../assets/images/projects/Fraud Detection with ML/eda/transaction_amt_dist_log_scale.png" alt="Transaction amount distribution (log scale)" /></p>

<ul>
  <li><strong>96.5 %</strong> non-fraud vs. <strong>3.5 %</strong> fraud</li>
  <li>Baseline models were trained on raw data to measure ‚Äúlift‚Äù from later oversampling/threshold tuning</li>
</ul>

<hr />

<h3 id="2-missing-value-patterns">2. Missing-Value Patterns</h3>

<p><img src="../assets/images/projects/Fraud Detection with ML/eda/missing_data_heatmap.png" alt="Missing data heatmap (sample of top 50 vars)" /></p>

<ul>
  <li>Many <code class="language-plaintext highlighter-rouge">id_</code> &amp; <code class="language-plaintext highlighter-rouge">Vxxx</code> features &gt; 85 % missing</li>
  <li>Suggests dropping or engineering ‚Äúmissingness‚Äù flags before modeling</li>
</ul>

<hr />

<h3 id="3-categorical-fraud-rates">3. Categorical Fraud Rates</h3>

<p><img src="../assets/images/projects/Fraud Detection with ML/eda/fraud_rate_ProductCD.png" alt="Fraud rate by ProductCD" /></p>

<ul>
  <li><strong>Product C</strong> has ~12 % fraud rate vs. ~3 % overall</li>
  <li><code class="language-plaintext highlighter-rouge">Discover</code> cards and <code class="language-plaintext highlighter-rouge">mobile</code> devices also show elevated risk</li>
</ul>

<hr />

<h3 id="4-temporal-signal">4. Temporal Signal</h3>

<p><img src="../assets/images/projects/Fraud Detection with ML/eda/fraud_ratio_by_hour.png" alt="Fraud ratio by hour of day" /></p>

<ul>
  <li>Fraud peaks around <strong>6 ‚Äì 9 AM</strong> (UTC)</li>
  <li>No strong day-of-week effect, but morning flag can improve feature set</li>
</ul>

<hr />

<h3 id="key-takeaways">Key Takeaways</h3>

<ul>
  <li><strong>Severe imbalance</strong> (3.5 % fraud) ‚Üí plan SMOTE/threshold tuning</li>
  <li><strong>High missingness</strong> in many features ‚Üí use missingness indicators or drop</li>
  <li><strong>Strong categorical drivers</strong> (ProductCD, card networks) ‚Üí prioritize in feature engineering</li>
  <li><strong>Temporal window</strong> matters ‚Üí add <code class="language-plaintext highlighter-rouge">IsMorning</code>/<code class="language-plaintext highlighter-rouge">IsNight</code> flags</li>
</ul>

<hr />

<h2 id="-data-preprocessing-pipeline">üîß Data Preprocessing Pipeline</h2>

<p>Full notebook: <a href="https://github.com/alexmatiasas/Fraud-Detection-with-ML/blob/main/notebooks/02_Preprocessing_Modeling_in_Python.ipynb">02_Preprocessing_Modeling_in_Python.ipynb</a></p>

<p>To prepare the IEEE-CIS dataset for modeling, we built a simple, reproducible pipeline that applies:</p>

<ul>
  <li>üì• <strong>Missing-value imputation</strong>
    <ul>
      <li>Numerical ‚Üí median</li>
      <li>Categorical ‚Üí most frequent</li>
    </ul>
  </li>
  <li>üî§ <strong>Categorical encoding</strong>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">LabelEncoder</code> per column, saved to <code class="language-plaintext highlighter-rouge">models/label_encoders.pkl</code></li>
    </ul>
  </li>
  <li>üìè <strong>Feature scaling</strong>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">StandardScaler</code> on all numeric features, saved to <code class="language-plaintext highlighter-rouge">models/scaler.pkl</code></li>
    </ul>
  </li>
  <li>üíæ <strong>Data export</strong>
    <ul>
      <li>Cleaned DataFrame written to <code class="language-plaintext highlighter-rouge">data/processed/train_clean.csv</code></li>
    </ul>
  </li>
</ul>

<blockquote>
  <p><strong>Pseudocode overview</strong></p>
  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 1) Impute
</span><span class="n">df</span><span class="p">[</span><span class="n">num_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="s">'median'</span><span class="p">).</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">num_cols</span><span class="p">])</span>
<span class="n">df</span><span class="p">[</span><span class="n">cat_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="s">'most_frequent'</span><span class="p">).</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">cat_cols</span><span class="p">])</span>

<span class="c1"># 2) Encode
</span><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cat_cols</span><span class="p">:</span>
    <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">().</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span>

<span class="c1"># 3) Scale
</span><span class="n">df</span><span class="p">[</span><span class="n">num_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">().</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">num_cols</span><span class="p">])</span>

<span class="c1"># 4) Persist transformers and cleaned data
</span><span class="n">joblib</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">scaler</span><span class="p">,</span> <span class="s">'models/scaler.pkl'</span><span class="p">)</span>
<span class="n">joblib</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">encoders</span><span class="p">,</span> <span class="s">'models/label_encoders.pkl'</span><span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s">'data/processed/train_clean.csv'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div>  </div>
</blockquote>

<p><strong>Why this matters</strong></p>

<ul>
  <li><strong>Reproducibility:</strong> Same exact logic runs in both notebooks and the FastAPI service.</li>
  <li><strong>Modularity:</strong> Transformers are versioned via <code class="language-plaintext highlighter-rouge">joblib</code>, so you can swap in SMOTE, PCA or any new step later without touching your API.</li>
  <li><strong>Performance:</strong> Full preprocess on ~590 K √ó 434 data executes in seconds, keeping your inference path lightweight.</li>
</ul>

<hr />

<p>Next up, we‚Äôll load this clean data, split with stratification, and benchmark our first models (Logistic Regression, Random Forest, XGBoost, etc.). Let me know if you‚Äôd like that section drafted too!</p>

<hr />

<h2 id="-baseline-models">üèÅ Baseline Models</h2>

<p>To set a performance floor, we trained two vanilla classifiers on the fully preprocessed data (no sampling, no feature selection). All scores are stratified 5-fold CV averages:</p>

<table>
  <thead>
    <tr>
      <th>Model</th>
      <th style="text-align: right">Accuracy</th>
      <th style="text-align: right">Precision</th>
      <th style="text-align: right">Recall</th>
      <th style="text-align: right">F1-Score</th>
      <th style="text-align: right">ROC AUC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Logistic Regression</td>
      <td style="text-align: right">0.972</td>
      <td style="text-align: right">0.825</td>
      <td style="text-align: right">0.264</td>
      <td style="text-align: right">0.400</td>
      <td style="text-align: right">0.856</td>
    </tr>
    <tr>
      <td>Random Forest</td>
      <td style="text-align: right">0.980</td>
      <td style="text-align: right">0.942</td>
      <td style="text-align: right">0.449</td>
      <td style="text-align: right">0.608</td>
      <td style="text-align: right">0.933</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th>Model</th>
      <th style="text-align: right">ROC-AUC Plot</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Logistic Regression</td>
      <td style="text-align: right"><img src="../assets/images/projects/Fraud Detection with ML/reports/roc_curve_logistic_regression.png" alt="ROC AUC Log Reg" width="500" /></td>
    </tr>
    <tr>
      <td>Random Forest</td>
      <td style="text-align: right"><img src="../assets/images/projects/Fraud Detection with ML/reports/roc_curve_random_forest.png" alt="ROC AUC Random Forest" width="500" /></td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p><strong>Key takeaways:</strong></p>
  <ul>
    <li>Random Forest improves ROC AUC by ~0.08 over Logistic Regression.</li>
    <li>Logistic Regression still offers very fast training &amp; simple interpretation.</li>
  </ul>
</blockquote>

<p><em>For a full side‚Äêby‚Äêside of all models (including tuned ensembles and stacking), check out:</em><br />
<img src="../assets/images/projects/Fraud Detection with ML/reports/model_comparison_heatmap.png" alt="Model Comparison Heatmap" /></p>

<hr />

<h2 id="Ô∏è-phase-2-advanced-models--ensembles">‚öôÔ∏è Phase 2: Advanced Models &amp; Ensembles</h2>

<p>After establishing our baseline, we pushed three state-of-the-art gradient boosters through hyperparameter tuning, and then combined them via two ensemble strategies. All scores are stratified 5-fold CV averages on the preprocessed data.</p>

<hr />

<h3 id="1-xgboost">1 XGBoost</h3>

<p>We initialized XGBoost with common defaults and then we would tuned via <code class="language-plaintext highlighter-rouge">GridSearchCV</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">xgb</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">(</span>
    <span class="n">n_estimators</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
    <span class="n">max_depth</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">subsample</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">colsample_bytree</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">use_label_encoder</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">eval_metric</span><span class="o">=</span><span class="s">'logloss'</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
<span class="p">)</span>
</code></pre></div></div>

<p><strong>Key metrics</strong></p>

<ul>
  <li>üöÄ ROC AUC: 0.9234</li>
  <li>üéØ Precision (fraud): 0.957</li>
  <li>üîç Recall (fraud): 0.589</li>
  <li>üéõÔ∏è F1-Score (fraud): 0.729</li>
</ul>

<p><strong>Observations</strong>:</p>

<ul>
  <li>Strong out-of-the-box performance, beating Logistic Regression by +0.07 AUC.</li>
  <li>High precision means few false alarms; recall (0.59) leaves room for further improvement via oversampling.</li>
</ul>

<h3 id="2-lightgbm">2 LightGBM</h3>

<p>LightGBM is a fast, memory-efficient gradient boosting framework:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lgb</span> <span class="o">=</span> <span class="n">LGBMClassifier</span><span class="p">(</span>
    <span class="n">n_estimators</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
    <span class="n">max_depth</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">subsample</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">colsample_bytree</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
<span class="p">)</span>
</code></pre></div></div>

<p><strong>Key metrics</strong></p>

<ul>
  <li>üöÄ ROC AUC: 0.9157</li>
  <li>üéØ Precision (fraud): 0.880</li>
  <li>üîç Recall (fraud): 0.410</li>
  <li>üéõÔ∏è F1-Score (fraud): 0.560</li>
</ul>

<p><strong>Observations</strong>:</p>

<ul>
  <li>Slightly lower AUC than XGBoost but still highly discriminative.</li>
  <li>Very fast training on large data‚Äîideal for rapid iteration.</li>
</ul>

<h3 id="3-catboost">3 CatBoost</h3>

<p>CatBoost natively handles categorical features and counteracts imbalance efficiently:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cb</span> <span class="o">=</span> <span class="n">CatBoostClassifier</span><span class="p">(</span>
    <span class="n">iterations</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">depth</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span>
<span class="p">)</span>
</code></pre></div></div>

<p><strong>Key metrics</strong></p>

<ul>
  <li>üöÄ ROC AUC: 0.9174</li>
  <li>üéØ Precision (fraud): 0.946</li>
  <li>üîç Recall (fraud): 0.497</li>
  <li>üéõÔ∏è F1-Score (fraud): 0.651</li>
</ul>

<p><strong>Observations</strong>:</p>

<ul>
  <li>Competitive AUC close to LightGBM with minimal encoding effort.</li>
  <li>Good balance of precision/recall out of the box.</li>
</ul>

<p>In the next phase, we‚Äôll perform hyperparameter tuning to maximize our classification performance‚Äîfocusing especially on the <strong>F1-score</strong>, which is crucial when the positive (fraud) class is both rare and of primary interest.</p>

<h2 id="Ô∏è-phase-3-hyperparameter-tuning">‚öôÔ∏è Phase 3: Hyperparameter Tuning</h2>

<p>In this phase, we applied grid and randomized searches to each of our core models‚ÄîLogistic Regression, Random Forest, XGBoost, LightGBM and CatBoost‚Äîusing a small subsample for speed, then retrained the best estimators on the full data to measure real-world performance.</p>

<table>
  <thead>
    <tr>
      <th>Model</th>
      <th>Best Parameters</th>
      <th style="text-align: right">ROC AUC</th>
      <th style="text-align: right">Precision (fraud)</th>
      <th style="text-align: right">Recall (fraud)</th>
      <th style="text-align: right">F1-Score (fraud)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Logistic Regression</strong></td>
      <td><code class="language-plaintext highlighter-rouge">C=0.01</code>, <code class="language-plaintext highlighter-rouge">penalty='l2'</code>, <code class="language-plaintext highlighter-rouge">solver='liblinear'</code></td>
      <td style="text-align: right">0.818</td>
      <td style="text-align: right">0.825</td>
      <td style="text-align: right">0.264</td>
      <td style="text-align: right">0.400</td>
    </tr>
    <tr>
      <td><strong>Random Forest</strong></td>
      <td><code class="language-plaintext highlighter-rouge">n_estimators=300</code>, <code class="language-plaintext highlighter-rouge">max_depth=20</code>, <code class="language-plaintext highlighter-rouge">min_samples_split=2</code>, <code class="language-plaintext highlighter-rouge">min_samples_leaf=2</code>, <code class="language-plaintext highlighter-rouge">max_features='sqrt'</code></td>
      <td style="text-align: right">0.911</td>
      <td style="text-align: right">0.940</td>
      <td style="text-align: right">0.370</td>
      <td style="text-align: right">0.530</td>
    </tr>
    <tr>
      <td><strong>XGBoost</strong></td>
      <td><code class="language-plaintext highlighter-rouge">subsample=0.8</code>, <code class="language-plaintext highlighter-rouge">n_estimators=500</code>, <code class="language-plaintext highlighter-rouge">max_depth=10</code>, <code class="language-plaintext highlighter-rouge">learning_rate=0.05</code>, <code class="language-plaintext highlighter-rouge">colsample_bytree=0.6</code>, <code class="language-plaintext highlighter-rouge">gamma=0</code>, <code class="language-plaintext highlighter-rouge">min_child_weight=1</code></td>
      <td style="text-align: right">0.969</td>
      <td style="text-align: right">0.957</td>
      <td style="text-align: right">0.589</td>
      <td style="text-align: right">0.729</td>
    </tr>
    <tr>
      <td><strong>LightGBM</strong></td>
      <td><code class="language-plaintext highlighter-rouge">subsample=0.6</code>, <code class="language-plaintext highlighter-rouge">n_estimators=500</code>, <code class="language-plaintext highlighter-rouge">max_depth=10</code>, <code class="language-plaintext highlighter-rouge">learning_rate=0.1</code>, <code class="language-plaintext highlighter-rouge">colsample_bytree=1.0</code>, <code class="language-plaintext highlighter-rouge">num_leaves=63</code>, <code class="language-plaintext highlighter-rouge">min_child_samples=10</code></td>
      <td style="text-align: right">0.964</td>
      <td style="text-align: right">0.930</td>
      <td style="text-align: right">0.620</td>
      <td style="text-align: right">0.740</td>
    </tr>
    <tr>
      <td><strong>CatBoost</strong></td>
      <td><code class="language-plaintext highlighter-rouge">iterations=500</code>, <code class="language-plaintext highlighter-rouge">depth=8</code>, <code class="language-plaintext highlighter-rouge">learning_rate=0.1</code>, <code class="language-plaintext highlighter-rouge">border_count=128</code>, <code class="language-plaintext highlighter-rouge">l2_leaf_reg=1</code>, <code class="language-plaintext highlighter-rouge">bagging_temperature=0</code></td>
      <td style="text-align: right">0.960</td>
      <td style="text-align: right">0.950</td>
      <td style="text-align: right">0.500</td>
      <td style="text-align: right">0.651</td>
    </tr>
  </tbody>
</table>

<h3 id="-key-takeaways">üîç Key Takeaways</h3>

<ul>
  <li><strong>Defaults were strong</strong>: Logistic Regression actually saw a drop in AUC after tuning, indicating its default C=1 was near-optimal for our data.</li>
  <li><strong>Tree-based gains</strong>: XGBoost tuning delivered the best AUC (0.969), closely followed by LightGBM and CatBoost.</li>
  <li><strong>Precision vs. recall</strong>: All tuned boosters maintain very high precision (&gt;0.93) but recall ranges from 0.50 (CatBoost) to 0.62 (LightGBM), suggesting further imbalance strategies could improve fraud capture.</li>
</ul>

<h2 id="-phase-4-ensemble-models">üîó Phase 4: Ensemble Models</h2>

<p>In the final stage, we combined our top-tuned boosters into two ensemble strategies to maximize robustness and performance.</p>

<hr />

<h3 id="1-soft-voting-ensemble">1 Soft Voting Ensemble</h3>

<p>We created a <code class="language-plaintext highlighter-rouge">VotingClassifier</code> that averages the predicted probabilities of our three best models:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">VotingClassifier</span>

<span class="n">ensemble_voting</span> <span class="o">=</span> <span class="n">VotingClassifier</span><span class="p">(</span>
    <span class="n">estimators</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s">"xgb"</span><span class="p">,</span> <span class="n">best_xgb_model</span><span class="p">),</span>
        <span class="p">(</span><span class="s">"lgb"</span><span class="p">,</span> <span class="n">best_lgb_model</span><span class="p">),</span>
        <span class="p">(</span><span class="s">"cat"</span><span class="p">,</span> <span class="n">best_cat_model</span><span class="p">)</span>
    <span class="p">],</span>
    <span class="n">voting</span><span class="o">=</span><span class="s">"soft"</span><span class="p">,</span>      <span class="c1"># average probabilities
</span>    <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>  <span class="c1"># equal weighting
</span>    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span>
<span class="p">)</span>

<span class="n">ensemble_voting</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</code></pre></div></div>

<p>Voting Ensemble Metrics</p>

<ul>
  <li>üöÄ ROC AUC: 0.9648</li>
  <li>üéØ Precision (fraud): 0.955</li>
  <li>üîç Recall (fraud): 0.571</li>
  <li>üéõÔ∏è F1-Score (fraud): 0.715</li>
</ul>

<h3 id="2-stacking-ensemble">2 Stacking Ensemble</h3>

<p>Next, we used a StackingClassifier to learn optimal combinations of base-model outputs, with a LogisticRegression meta‚Äêlearner:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">StackingClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>

<span class="n">stacking</span> <span class="o">=</span> <span class="n">StackingClassifier</span><span class="p">(</span>
    <span class="n">estimators</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s">"xgb"</span><span class="p">,</span> <span class="n">best_xgb_model</span><span class="p">),</span>
        <span class="p">(</span><span class="s">"lgb"</span><span class="p">,</span> <span class="n">best_lgb_model</span><span class="p">),</span>
        <span class="p">(</span><span class="s">"cat"</span><span class="p">,</span> <span class="n">best_cat_model</span><span class="p">)</span>
    <span class="p">],</span>
    <span class="n">final_estimator</span><span class="o">=</span><span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span>
    <span class="n">passthrough</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span>
<span class="p">)</span>

<span class="n">stacking</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</code></pre></div></div>

<p>Stacking Ensemble Metrics</p>

<ul>
  <li>üöÄ ROC AUC: 0.9691</li>
  <li>üéØ Precision (fraud): 0.924</li>
  <li>üîç Recall (fraud): 0.679</li>
  <li>üéõÔ∏è F1-Score (fraud): 0.783</li>
</ul>

<p>Therefore, the <strong>stacking ensemble</strong> emerges as the clear winner‚Äîas shown in our baseline comparison table.</p>

<hr />

<h2 id="-testing">üß™ Testing</h2>

<p>We implemented tests to ensure pipeline integrity:</p>

<ul>
  <li>‚úÖ Preprocessing pipeline does not crash with valid data</li>
  <li>‚úÖ API responds with expected output structure</li>
  <li>‚úÖ Unit tests managed with <code class="language-plaintext highlighter-rouge">pytest</code></li>
</ul>

<hr />

<h2 id="Ô∏è-deployment">üñ•Ô∏è Deployment</h2>

<p>The final model was locally deployed using <strong>FastAPI</strong>. Key features:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">/predict</code> endpoint returns prediction and fraud probability</li>
  <li>Interactive Swagger UI available at <code class="language-plaintext highlighter-rouge">/docs</code></li>
  <li>Can be run locally via Uvicorn or deployed in a Docker container</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>uvicorn src.main:app <span class="nt">--reload</span>
</code></pre></div></div>

<p>Or with Docker</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker pull alexmatiasastorga/fraud-api:latest
docker run <span class="nt">-d</span> <span class="nt">-p</span> 8000:8000 alexmatiasastorga/fraud-api
</code></pre></div></div>

<h2 id="-conclusion">üìå Conclusion</h2>

<p>This project demonstrates a real-world machine learning workflow from raw data to deployment. Future improvements may include:</p>

<ul>
  <li>DAG automation with Apache Airflow</li>
  <li>Cloud deployment (Render or AWS)</li>
  <li>Monitoring with MLFlow or Prometheus</li>
</ul>

<h2 id="-links">üîó Links</h2>

<ul>
  <li>üîç <a href="https://github.com/alexmatiasas/Fraud-Detection-with-ML">Project Repository</a></li>
  <li>üê≥ <a href="https://hub.docker.com/r/alexmatiasastorga/fraud-api">Docker Image</a></li>
</ul>

        
      </section>

      <footer class="page__meta">
        
        


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2025-06-19T16:44:59-06:00">June 19, 2025</time></p>

      </footer>

      <section class="page__share">
  <h4 class="page__share-title">Share on</h4>

  <a href="https://twitter.com/intent/tweet?via=alexmatiasas&text=%20https%3A%2F%2Falexmatiasas.github.io%2F2025-05-12-fraud-detection%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Falexmatiasas.github.io%2F2025-05-12-fraud-detection%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://alexmatiasas.github.io/2025-05-12-fraud-detection/" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/2025-04-21-sentiment-analysis/" class="pagination--pager" title="
">Previous</a>
    
    
      <a href="#" class="pagination--pager disabled">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    
<div class="page__related">
  
  <h2 class="page__related-title">You may also enjoy</h2>
  <div class="grid__wrapper">
    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/teaser.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025-04-21-sentiment-analysis/" rel="permalink">
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">
</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/teaser.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2016-07-20-use-patterns/" rel="permalink">
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          less than 1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">
</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/teaser.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2016-07-20-text-generation/" rel="permalink">
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          less than 1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">
</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/teaser.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2016-07-20-sentiment-analysis/" rel="permalink">
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          less than 1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">
</p>
  </article>
</div>

    
  </div>
</div>

  
  
</div>

      
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="mailto: alejandromatiasastorga@gmail.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope" aria-hidden="true"></i> Email</a></li>
        
      
        
          <li><a href="/" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-globe" aria-hidden="true"></i> Website</a></li>
        
      
        
          <li><a href="https://github.com/alexmatiasas" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://www.linkedin.com/in/alexmatiasastorga/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> Linkedin</a></li>
        
      
        
          <li><a href="https://www.kaggle.com/alejandromatias" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-kaggle" aria-hidden="true"></i> Kaggle</a></li>
        
      
    

    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 <a href="https://alexmatiasas.github.io">Manuel Alejandro Mat√≠as Astorga</a>. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/jekyll-themes/minimal-mistakes/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>






  </body>
</html>
